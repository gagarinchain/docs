<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Tutorial · Gagarin.network</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="## Functionality"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Tutorial · Gagarin.network"/><meta property="og:type" content="website"/><meta property="og:url" content="https://gagarinchain.github.io/"/><meta property="og:description" content="## Functionality"/><meta property="og:image" content="https://gagarinchain.github.io/img/undraw_online.svg"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://gagarinchain.github.io/img/undraw_tweetstorm.svg"/><link rel="shortcut icon" href="/img/favicon.ico"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/img/favicon.ico" alt="Gagarin.network"/><h2 class="headerTitleWithLogo">Gagarin.network</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/docs/overview" target="_self">Docs</a></li><li class=""><a href="/docs/api" target="_self">API</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Tutorial</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">Overview</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/overview">Overview</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Architecture</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/architecture">Architecture</a></li><li class="navListItem"><a class="navItem" href="/docs/consensus">Hotstuff</a></li><li class="navListItem"><a class="navItem" href="/docs/blockchain">Blockchain</a></li><li class="navListItem"><a class="navItem" href="/docs/encryption">Encryption</a></li><li class="navListItem"><a class="navItem" href="/docs/networking">Network</a></li><li class="navListItem"><a class="navItem" href="/docs/oracles">Oracles</a></li><li class="navListItem"><a class="navItem" href="/docs/plugins">Plugins</a></li><li class="navListItem"><a class="navItem" href="/docs/startup">Configuration</a></li><li class="navListItem"><a class="navItem" href="/docs/transactions">Transactions</a></li><li class="navListItem"><a class="navItem" href="/docs/rollups">Rollups</a></li><li class="navListItem"><a class="navItem" href="/docs/state">Sate</a></li><li class="navListItem"><a class="navItem" href="/docs/gateway">Gateway</a></li><li class="navListItem"><a class="navItem" href="/docs/monitoring">Monitoring</a></li><li class="navListItem"><a class="navItem" href="/docs/utils">Utilities</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Tutorial</h3><ul class=""><li class="navListItem navListItemActive"><a class="navItem" href="/docs/tutorial">Tutorial</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">What&#x27;s next</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/future">This is future</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 id="__docusaurus" class="postHeaderTitle">Tutorial</h1></header><article><div><span><h2><a class="anchor" aria-hidden="true" id="functionality"></a><a href="#functionality" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Functionality</h2>
<p>To create plugin at first you need to decide what events and data you need to receive from the blockchain. Usually we will have some diagram, for example for rollups plugin, which we will develop in the tutorial, we have sequence diagram in <a href="/docs/rollups">rollups</a> section.</p>
<h2><a class="anchor" aria-hidden="true" id="interfaces"></a><a href="#interfaces" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Interfaces</h2>
<p>Since we analyze requirements we found out interfaces we want to implement</p>
<p>To send data to Ethereum smart contract we need <code>common_pb.OnBlockCommitServer</code></p>
<p>To check received block's data for rollups validity we need <code>common_pb.OnReceiveProposalServer</code></p>
<p>To create rollup data from receipts and write it into <code>block.data</code> field we need <code>common_pb.OnNewBlockCreatedServer</code></p>
<h2><a class="anchor" aria-hidden="true" id="method-implementation"></a><a href="#method-implementation" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Method implementation</h2>
<p>We will briefly implement methods here</p>
<h3><a class="anchor" aria-hidden="true" id="onnewblockcreatedserver"></a><a href="#onnewblockcreatedserver" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>OnNewBlockCreatedServer</h3>
<p>We use this interface to create rollup, when we propose block</p>
<ol>
<li>Return empty rollup in case it was empty block</li>
<li>Create rollup from receipts we calculated</li>
<li>Marshal and return new mutated block</li>
</ol>
<pre><code class="hljs css language-golang"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(r *RollupsPlugin)</span> <span class="hljs-title">OnNewBlockCreated</span><span class="hljs-params">(ctx context.Context, in *common_pb.OnNewBlockCreatedRequest)</span> <span class="hljs-params">(*common_pb.OnNewBlockCreatedResponse, error)</span></span> {
    log.Debugf(<span class="hljs-string">"Creating rollup for block %v"</span>, common.Bytes2Hex(in.Block.Header.Hash))
    <span class="hljs-comment">//1</span>
    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(in.Receipts) == <span class="hljs-number">0</span> {
        log.Infof(<span class="hljs-string">"Block %v has no receipts"</span>, common.Bytes2Hex(in.Block.Header.Hash))
        <span class="hljs-keyword">return</span> &amp;common_pb.OnNewBlockCreatedResponse{
            Block: in.Block,
        }, <span class="hljs-literal">nil</span>
    }
    
    <span class="hljs-comment">//2</span>
    addresses, txs := r.createRollups(in.Receipts)
    roll := &amp;Rollup{
        Accounts:     addresses,
        Transactions: txs,
    }

    log.Infof(<span class="hljs-string">"Created rollup for %v block"</span>, common.Bytes2Hex(in.Block.Header.Hash))
    spew.Dump(roll)

    <span class="hljs-comment">//3</span>
    marshal, err := ssz.Marshal(roll)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err
    }

    in.Block.Data.Data = marshal
    <span class="hljs-keyword">return</span> &amp;common_pb.OnNewBlockCreatedResponse{
        Block: in.Block,
    }, <span class="hljs-literal">nil</span>
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="onreceiveproposalserver"></a><a href="#onreceiveproposalserver" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>OnReceiveProposalServer</h3>
<p><code>OnReceiveProposalServer</code> interface has 4 functions, since we want to validate rollup we need to implement our logic only in <code>AfterProposedBlockAdded</code>. We leave other functions dummy implemented.</p>
<ol>
<li>We get transactions receipts, which we get after <code>applyTx()</code>  and calculate our version of rollup for this block</li>
<li>Do validations and equality checks on this block, in case of error return error, which will reject this block</li>
</ol>
<pre><code class="hljs css language-golang"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(r *RollupsPlugin)</span> <span class="hljs-title">BeforeProposedBlockAdded</span><span class="hljs-params">(ctx context.Context,
    in *common_pb.BeforeProposedBlockAddedRequest)</span> <span class="hljs-params">(*common_pb.BeforeProposedBlockAddedResponse, error)</span></span> {
    <span class="hljs-keyword">return</span> &amp;common_pb.BeforeProposedBlockAddedResponse{
        Proposal: in.Proposal,
    }, <span class="hljs-literal">nil</span>
}
    
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(r *RollupsPlugin)</span> <span class="hljs-title">AfterProposedBlockAdded</span><span class="hljs-params">(ctx context.Context, in *common_pb.AfterProposedBlockAddedRequest)</span> <span class="hljs-params">(*common_pb.AfterProposedBlockAddedResponse, error)</span></span> {
    log.Debugf(<span class="hljs-string">"After proposed block %v added"</span>, common.Bytes2Hex(in.Proposal.Block.Header.Hash))

    <span class="hljs-comment">//1</span>
    mapping, transactions := r.createRollups(in.Receipts)

    <span class="hljs-comment">//2</span>
    rm := &amp;Rollup{}
    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(in.GetProposal().GetBlock().GetData().GetData()) &gt; <span class="hljs-number">0</span> {
        <span class="hljs-keyword">if</span> err := ssz.Unmarshal(in.GetProposal().GetBlock().GetData().GetData(), rm); err != <span class="hljs-literal">nil</span> {
            log.Error(<span class="hljs-string">"Bad received rollup format"</span>, err)
            <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err
        }
        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(mapping) != <span class="hljs-built_in">len</span>(rm.Accounts) || <span class="hljs-built_in">len</span>(transactions) != <span class="hljs-built_in">len</span>(rm.Transactions) {
            err := errors.New(<span class="hljs-string">"lengths of rollups are not equal"</span>)
            log.Debug(<span class="hljs-string">"Lengths of rollups structures do not match(cr:r), accounts[%v:%v], transactions:[%v:%v]"</span>,
                <span class="hljs-built_in">len</span>(mapping), <span class="hljs-built_in">len</span>(rm.Accounts), <span class="hljs-built_in">len</span>(transactions), <span class="hljs-built_in">len</span>(rm.Transactions))
            <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err
        }
        ...
    }

    log.Infof(<span class="hljs-string">"Valid rollup for %v block"</span>, common.Bytes2Hex(in.Proposal.Block.Header.Hash))
    <span class="hljs-keyword">return</span> &amp;common_pb.AfterProposedBlockAddedResponse{}, <span class="hljs-literal">nil</span>
}   
    
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(r *RollupsPlugin)</span> <span class="hljs-title">BeforeVoted</span><span class="hljs-params">(ctx context.Context, in *common_pb.BeforeVotedRequest)</span> <span class="hljs-params">(*common_pb.BeforeVotedResponse, error)</span></span> {
    <span class="hljs-keyword">return</span> &amp;common_pb.BeforeVotedResponse{
        Vote: in.Vote,
    }, <span class="hljs-literal">nil</span>
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(r *RollupsPlugin)</span> <span class="hljs-title">AfterVoted</span><span class="hljs-params">(ctx context.Context, in *common_pb.AfterVotedRequest)</span> <span class="hljs-params">(*common_pb.AfterVotedResponse, error)</span></span> {
    <span class="hljs-keyword">return</span> &amp;common_pb.AfterVotedResponse{}, <span class="hljs-literal">nil</span>
}
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="onblockcommitserver"></a><a href="#onblockcommitserver" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>OnBlockCommitServer</h3>
<p><code>OnBlockCommitServer</code> interface has one function to implement</p>
<ol>
<li>In this function we will run Settlement watcher, that will match <code>Settlement</code> transactions with pending deposit in smart contract to send <code>Agreement</code></li>
<li>Get last height of processed rollup and calculate needed blocks to send rollups from</li>
<li>For each block create rollup message and send it</li>
</ol>
<pre><code class="hljs css language-golang"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(r *RollupsPlugin)</span> <span class="hljs-title">OnBlockCommit</span><span class="hljs-params">(ctx context.Context, req *common_pb.OnBlockCommitRequest)</span> <span class="hljs-params">(*common_pb.OnBlockCommitResponse, error)</span></span> {
    log.Debug(<span class="hljs-string">"On block commit"</span>)
    
    <span class="hljs-comment">//1</span>
    <span class="hljs-keyword">for</span> _, t := <span class="hljs-keyword">range</span> req.GetBlock().Txs {
        <span class="hljs-keyword">if</span> t.Type == <span class="hljs-keyword">int32</span>(api.Settlement) &amp;&amp; bytes.Equal([]<span class="hljs-keyword">byte</span>(<span class="hljs-string">"lock"</span>), t.Data) {
            r.watchPending(ctx, t)
        }
    }
    ... 
    
    <span class="hljs-comment">//2</span>
    contractHeight, err := r.rollupApi.GetTopHeight(&amp;bind.CallOpts{})
    <span class="hljs-keyword">var</span> fork []*common_pb.BlockS
    <span class="hljs-keyword">if</span> req.Block.Header.Height &gt; <span class="hljs-keyword">int32</span>(contractHeight) + <span class="hljs-number">1</span> {
        log.Infof(<span class="hljs-string">"Loading fork starting at %v to %v"</span>, contractHeight, req.Block.Header.Height)
        loaded, err := r.client.Pbc().GetFork(ctx, &amp;common_pb.GetForkRequest{
            Height:   <span class="hljs-keyword">int32</span>(contractHeight) + <span class="hljs-number">1</span>,
            HeadHash: req.Block.Header.ParentHash,
        })
        <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
            log.Error(<span class="hljs-string">"Get fork failed"</span>, err)
            <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err
        }

        sort.Sort(ByHeight(loaded.GetBlocks()))

        fork = <span class="hljs-built_in">append</span>(loaded.Blocks, req.Block)
    }
    ...
    
    <span class="hljs-comment">//3</span>
    
    <span class="hljs-keyword">for</span> _, b := <span class="hljs-keyword">range</span> fork {
        h := &amp;SendableHeader{
            Height:    <span class="hljs-keyword">uint32</span>(b.GetHeader().GetHeight()),
            Hash:      hash,
            TxHash:    txHash,
            StateHash: stateHash,
            DataHash:  dataHash,
            QcHash:    qcHash,
            Parent:    parentHash,
            Timestamp: <span class="hljs-keyword">uint64</span>(b.GetHeader().GetTimestamp()),
        }

        mh, err := ssz.Marshal(h)
        <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
            log.Error(err)
            <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err
        }
        
        r.refreshNonce()

        _, err = r.rollupApi.AddBlock(r.txOpts, mh, emptyBytes(b.Data.Data), <span class="hljs-built_in">make</span>([]<span class="hljs-keyword">byte</span>, <span class="hljs-number">0</span>))
        <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
            log.Error(<span class="hljs-string">"AddBlock failed"</span>, err)
            <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err
        }
    }
    ... 
    
    log.Infof(<span class="hljs-string">"%v sent %v rollups"</span>, common.Bytes2Hex(req.Me.GetAddress()), <span class="hljs-built_in">len</span>(fork))
    <span class="hljs-keyword">return</span> &amp;common_pb.OnBlockCommitResponse{}, <span class="hljs-literal">nil</span>
    
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="bootstrap"></a><a href="#bootstrap" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Bootstrap</h3>
<p>We want to implement some starting routines here</p>
<pre><code class="hljs css language-golang"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(r *RollupsPlugin)</span> <span class="hljs-title">Bootstrap</span><span class="hljs-params">(cfg Config)</span> <span class="hljs-title">error</span></span> {
    log.Info(<span class="hljs-string">"Bootstrapping rollups plugin"</span>)
    lis, err := net.Listen(<span class="hljs-string">"tcp"</span>, cfg.Address)
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        <span class="hljs-keyword">return</span> err
    }

    opts := []grpc.ServerOption{grpc.MaxConcurrentStreams(cfg.MaxConcurrentStreams)}
    grpcServer := grpc.NewServer(opts...)
    common_pb.RegisterOnBlockCommitServer(grpcServer, r)
    common_pb.RegisterOnReceiveProposalServer(grpcServer, r)
    common_pb.RegisterOnNewBlockCreatedServer(grpcServer, r)
    <span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> {
        <span class="hljs-keyword">if</span> err := grpcServer.Serve(lis); err != <span class="hljs-literal">nil</span> {
            log.Error(err)
        }
    }()
    log.Info(<span class="hljs-string">"Rollups plugin bootstrapped"</span>)
    <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
}
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="configuration"></a><a href="#configuration" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Configuration</h2>
<p>Here we configure rollups as first plugin. We have another plugin called prover just for to show how we can configure more than one plugin in Settings.yaml</p>
<pre><code class="hljs css language-yaml"><span class="hljs-string">...</span>
<span class="hljs-attr">Plugins:</span>
    <span class="hljs-comment">#rollups</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">Address:</span> <span class="hljs-number">172.18</span><span class="hljs-number">.0</span><span class="hljs-number">.98</span><span class="hljs-string">:9380</span>
    <span class="hljs-attr">Interfaces:</span> <span class="hljs-string">['OnBlockCommit',</span> <span class="hljs-string">'OnReceiveProposal'</span><span class="hljs-string">,</span> <span class="hljs-string">'OnNewBlockCreated'</span><span class="hljs-string">]</span>
    <span class="hljs-comment">#proover</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">Address:</span> <span class="hljs-number">172.18</span><span class="hljs-number">.0</span><span class="hljs-number">.99</span><span class="hljs-string">:9380</span>
    <span class="hljs-attr">Interfaces:</span> <span class="hljs-string">['OnBlockCommit']</span>
<span class="hljs-string">...</span>
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="conclusion"></a><a href="#conclusion" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Conclusion</h2>
<p>In this short tutorial we've shown how fast and easy developers can create complex products using Gagarin.network. For more information see <a href="api.md">api</a> section.</p>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/docs/utils"><span class="arrow-prev">← </span><span>Utilities</span></a><a class="docs-next button" href="/docs/future"><span>This is future</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#functionality">Functionality</a></li><li><a href="#interfaces">Interfaces</a></li><li><a href="#method-implementation">Method implementation</a><ul class="toc-headings"><li><a href="#onnewblockcreatedserver">OnNewBlockCreatedServer</a></li><li><a href="#onreceiveproposalserver">OnReceiveProposalServer</a></li><li><a href="#onblockcommitserver">OnBlockCommitServer</a></li><li><a href="#bootstrap">Bootstrap</a></li></ul></li><li><a href="#configuration">Configuration</a></li><li><a href="#conclusion">Conclusion</a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/" class="nav-home"><img src="/img/favicon.ico" alt="Gagarin.network" width="66" height="58"/></a><div><h5>Docs</h5><a href="/docs/overview.html">Docs</a><a href="/docs/api.html">API Reference</a></div><div><h5>More</h5><a href="https://gagarin.network">Site</a><a href="https://github.com/gagarinchain/docs">GitHub</a><a class="github-button" data-icon="octicon-star" data-count-href="/facebook/docusaurus/stargazers" data-show-count="true" data-count-aria-label="# stargazers on GitHub" aria-label="Star this project on GitHub">Star</a></div></section><a href="https://opensource.facebook.com/" target="_blank" rel="noreferrer noopener" class="fbOpenSource"><img src="/img/oss_logo.png" alt="Facebook Open Source" width="170" height="45"/></a><section class="copyright">Copyright © 2021 Gagarin.Network</section></footer></div></body></html>